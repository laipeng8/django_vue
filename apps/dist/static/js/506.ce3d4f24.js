"use strict";(self["webpackChunkbpvank_front_end"]=self["webpackChunkbpvank_front_end"]||[]).push([[506],{8506:function(e,l,a){a.r(l),a.d(l,{default:function(){return X}});var t=a(3396);const i=e=>((0,t.dD)("data-v-ff100586"),e=e(),(0,t.Cn)(),e),o={class:"addArticle_box"},r=(0,t.Uk)(" 新建文章 "),u={class:"write_abstract"},s=i((()=>(0,t._)("h4",null,"标题",-1))),n=i((()=>(0,t._)("p",null,"标示文章、作品内容的简明语句，填写醒目的",-1))),c={class:"write_abstract"},d={class:"write_abstract"},m=i((()=>(0,t._)("h4",null,"摘要",-1))),p=i((()=>(0,t._)("p",null,"筛选文章主要内容，让读者初步了解文章",-1))),w={class:"write_abstract"},f=i((()=>(0,t._)("h4",null,"缩略图",-1))),v=(0,t.Uk)("上传图片"),g=i((()=>(0,t._)("p",null,"注：点击上传的图片地址由系统生成，修改会导致图片失效",-1))),V={class:"write_abstract"},_=i((()=>(0,t._)("h4",null,"分类",-1))),b=i((()=>(0,t._)("p",null,"选择分类可让读者更便捷的查找文章",-1))),h={class:"write_abstract"},y=i((()=>(0,t._)("h4",null,"状态",-1))),C=i((()=>(0,t._)("p",null,"私密可视为草稿",-1))),A={class:"write_abstract"},x=i((()=>(0,t._)("h4",null,"评论",-1))),U=i((()=>(0,t._)("p",null,"开启评论，开启新世界",-1))),D={class:"write_abstract",style:{"text-align":"center",background:"none"}},I=(0,t.Uk)("预览"),W=(0,t.Uk)("提交"),F=i((()=>(0,t._)("p",null,"注：普通用户提交文章需要等待管理员审核",-1)));function N(e,l,a,i,N,k){const E=(0,t.up)("EditPen"),P=(0,t.up)("el-icon"),L=(0,t.up)("el-input"),S=(0,t.up)("Toolbar"),H=(0,t.up)("Editor"),M=(0,t.up)("el-col"),R=(0,t.up)("el-button"),z=(0,t.up)("el-upload"),O=(0,t.up)("el-option"),j=(0,t.up)("el-select"),B=(0,t.up)("el-row"),T=(0,t.up)("PreviewArticle");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t._)("div",o,[(0,t._)("h3",null,[(0,t.Wm)(P,{style:{"margin-right":"10px"}},{default:(0,t.w5)((()=>[(0,t.Wm)(E)])),_:1}),r]),(0,t.Wm)(B,{gutter:20},{default:(0,t.w5)((()=>[(0,t.Wm)(M,{xs:24,sm:24,md:24,lg:17,xl:17},{default:(0,t.w5)((()=>[(0,t._)("div",u,[s,(0,t.Wm)(L,{modelValue:e.write.titleValue,"onUpdate:modelValue":l[0]||(l[0]=l=>e.write.titleValue=l),placeholder:"请输入文章标题",maxlength:"50","show-word-limit":"",size:"large",clearable:""},null,8,["modelValue"]),n]),(0,t._)("div",c,[(0,t.Wm)(S,{editor:i.editorRef,defaultConfig:i.toolbarConfig,mode:i.mode},null,8,["editor","defaultConfig","mode"]),(0,t.Wm)(H,{style:{height:"420px","overflow-y":"hidden"},modelValue:i.valueHtml,"onUpdate:modelValue":l[1]||(l[1]=e=>i.valueHtml=e),defaultConfig:i.editorConfig,mode:i.mode,onOnCreated:i.handleCreated,onChange:e.change,class:"article"},null,8,["modelValue","defaultConfig","mode","onOnCreated","onChange"])])])),_:1}),(0,t.Wm)(M,{xs:24,sm:24,md:24,lg:7,xl:7},{default:(0,t.w5)((()=>[(0,t._)("div",d,[m,(0,t.Wm)(L,{modelValue:e.write.abstractValue,"onUpdate:modelValue":l[2]||(l[2]=l=>e.write.abstractValue=l),autosize:{minRows:3,maxRows:5},maxlength:"200","show-word-limit":"",type:"textarea",placeholder:"请简单概述文章内容",clearable:""},null,8,["modelValue"]),p]),(0,t._)("div",w,[f,(0,t.Wm)(L,{size:"large",modelValue:e.write.thumbnailValue,"onUpdate:modelValue":l[3]||(l[3]=l=>e.write.thumbnailValue=l),placeholder:"请点击上传图片或手动输入图片地址"},{append:(0,t.w5)((()=>[(0,t.Wm)(z,{ref:"uploadEle",class:"upload-demo",action:e.uploadURL,"on-success":i.handleAvatarSuccess,"before-upload":i.beforeUploadFunction,"show-file-list":!1},{trigger:(0,t.w5)((()=>[(0,t.Wm)(R,null,{default:(0,t.w5)((()=>[v])),_:1})])),_:1},8,["action","on-success","before-upload"])])),_:1},8,["modelValue"]),g]),(0,t._)("div",V,[_,(0,t.Wm)(j,{modelValue:e.write.classifyValue,"onUpdate:modelValue":l[4]||(l[4]=l=>e.write.classifyValue=l),placeholder:"请选择文章分类",size:"large"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.classifyInfo,(e=>((0,t.wg)(),(0,t.j4)(O,{label:e.classifyName,value:e.classifyId},null,8,["label","value"])))),256))])),_:1},8,["modelValue"]),b]),(0,t.Wm)(B,{gutter:20},{default:(0,t.w5)((()=>[(0,t.Wm)(M,{span:12},{default:(0,t.w5)((()=>[(0,t._)("div",h,[y,(0,t.Wm)(j,{modelValue:e.write.stateValue,"onUpdate:modelValue":l[5]||(l[5]=l=>e.write.stateValue=l),placeholder:"文章状态",size:"large"},{default:(0,t.w5)((()=>[(0,t.Wm)(O,{label:"公开",value:"1"}),(0,t.Wm)(O,{label:"私密",value:"2"})])),_:1},8,["modelValue"]),C])])),_:1}),(0,t.Wm)(M,{span:12},{default:(0,t.w5)((()=>[(0,t._)("div",A,[x,(0,t.Wm)(j,{modelValue:e.write.commentValue,"onUpdate:modelValue":l[6]||(l[6]=l=>e.write.commentValue=l),placeholder:"评论是否开启",size:"large"},{default:(0,t.w5)((()=>[(0,t.Wm)(O,{label:"开启",value:"1"}),(0,t.Wm)(O,{label:"关闭",value:"2"})])),_:1},8,["modelValue"]),U])])),_:1})])),_:1}),(0,t._)("div",D,[(0,t.Wm)(R,{text:"",onClick:l[7]||(l[7]=l=>e.previewArticleDialogFormVisible=!0)},{default:(0,t.w5)((()=>[I])),_:1}),(0,t.Wm)(R,{style:{width:"50%"},plain:"",color:"#2fa7b9",onClick:i.submitAdd},{default:(0,t.w5)((()=>[W])),_:1},8,["onClick"]),F])])),_:1})])),_:1})]),(0,t.Wm)(T,{previewArticleDialogFormVisible:e.previewArticleDialogFormVisible,valueHtml:i.valueHtml,onOnPreviewArticleCloseDialog:i.previewArticleCloseDialog},null,8,["previewArticleDialogFormVisible","valueHtml","onOnPreviewArticleCloseDialog"])],64)}const k={key:0},E=["innerHTML"],P={class:"dialog-footer"},L=(0,t.Uk)("退出预览");function S(e,l,a,i,o,r){const u=(0,t.up)("el-button"),s=(0,t.up)("el-dialog"),n=(0,t.Q2)("highlight");return i.isRouterAlive?((0,t.wg)(),(0,t.iD)("div",k,[(0,t.Wm)(s,{modelValue:a.previewArticleDialogFormVisible,"onUpdate:modelValue":l[1]||(l[1]=e=>a.previewArticleDialogFormVisible=e),title:"预览文章",width:"70%",draggable:"",onClose:l[2]||(l[2]=e=>i.previewArticleCloseDialog(!1))},{footer:(0,t.w5)((()=>[(0,t._)("span",P,[(0,t.Wm)(u,{onClick:l[0]||(l[0]=e=>i.previewArticleCloseDialog(!1))},{default:(0,t.w5)((()=>[L])),_:1})])])),default:(0,t.w5)((()=>[(0,t.wy)((0,t._)("div",{innerHTML:e.articleMain,class:"article"},null,8,E),[[n]])])),_:1},8,["modelValue"])])):(0,t.kq)("",!0)}var H=a(4870),M={props:["previewArticleDialogFormVisible","valueHtml"],emits:["onPreviewArticleCloseDialog"],setup(e,{emit:l}){(0,t.YP)((()=>e.valueHtml),((e,l)=>{a.articleMain=e}));const a=(0,H.qj)({previewArticleDialogFormVisible:e.previewArticleDialogFormVisible,articleMain:e.valueHtml}),i=(0,H.iH)(!0),o=e=>{l("onPreviewArticleCloseDialog",e),i.value=!1,(0,t.Y3)((()=>{i.value=!0}))};return{...(0,H.BK)(a),previewArticleCloseDialog:o,isRouterAlive:i}}},R=a(89);const z=(0,R.Z)(M,[["render",S]]);var O=z,j=a(6126),B=a(7178),T=a(6666),J=a(6265),Y=a.n(J);function q(e){Y().get("/showAllClassifyInfo").then((l=>{e.classifyInfo=l.data.data}))}var $={components:{Editor:j.M,Toolbar:j.o,PreviewArticle:O},setup(){const e=(0,H.XI)(),l=(0,H.iH)(""),a={},i={placeholder:"在Myblog，开始您的Write吧~",MENU_CONF:{}};(0,t.YP)(l.value,(function(e,l){Prism.highlightAll()})),(0,t.Jd)((()=>{const l=e.value;null!=l&&l.destroy()}));const o=l=>{e.value=l,console.log(l.getMenuConfig("codeSelectLang").codeLangs)};i.MENU_CONF["uploadImage"]={server:{NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_URL+"/articleImgUpload",maxFileSize:5242880,onFailed(e,l){B.z8.error(`${e.name} 上传失败`),console.log(`${e.name} 上传失败`,l)}},i.MENU_CONF["uploadVideo"]={server:{NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_URL+"/articleVideoUpload",maxFileSize:104857600,onFailed(e,l){B.z8.error(`${e.name} 上传失败`),console.log(`${e.name} 上传失败`,l)}},i.MENU_CONF["codeSelectLang"]={codeLangs:[{text:"CSS",value:"css"},{text:"HTML",value:"html"},{text:"XML",value:"xml"},{text:"Javascript",value:"javascript"},{text:"Typescript",value:"typescript"},{text:"JSX",value:"jsx"},{text:"Go",value:"go"},{text:"PHP",value:"php"},{text:"C",value:"c"},{text:"Python",value:"python"},{text:"Java",value:"java"},{text:"C++",value:"cpp"},{text:"C#",value:"csharp"},{text:"Visual Basic",value:"visual-basic"},{text:"SQL",value:"sql"},{text:"Ruby",value:"ruby"},{text:"Swift",value:"swift"},{text:"Bash",value:"bash"},{text:"Markdown",value:"markdown"}]};const r=(0,H.qj)({userInfo:null,write:{titleValue:"",abstractValue:"",thumbnailValue:"",classifyValue:"",stateValue:"1",commentValue:"1"},classifyInfo:[],uploadURL:{NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_URL+"/thumbnailUpload",previewArticleDialogFormVisible:!1});(0,t.bv)((()=>{const e=JSON.parse(sessionStorage.getItem("userInfo"));r.userInfo=e.data,q(r)}));const u=e=>"image/jpeg"!==e.type&&"image/jpg"!==e.type&&"image/png"!==e.type&&"image/gif"!==e.type?(B.z8.error("仅支持图片格式.png | .jpg | .jpeg | .gif "),!1):!(e.size/1024/1024>5)||(B.z8.error("仅支持大小不超过5MB的图片!"),!1),s=e=>{r.write.thumbnailValue=e.data.path},n=e=>{r.previewArticleDialogFormVisible=e},c=()=>{let e={};if(e=r.classifyInfo.find((e=>e.classifyId===r.write.classifyValue)),""!=r.write.titleValue&&""!=r.write.abstractValue&&""!=r.write.classifyValue&&""!=r.write.stateValue&&""!=r.write.commentValue){const a={userId:r.userInfo.userId,userName:r.userInfo.userName,articleTitle:r.write.titleValue,articleClassifyId:r.write.classifyValue,articleClassifyName:e.classifyName,articleDase:r.write.abstractValue,articleImgLitimg:r.write.thumbnailValue,articleContent:l.value,articleState:parseInt(r.write.stateValue),articlePass:0==r.userInfo.userType?2:1,commentState:parseInt(r.write.commentValue)};Y().post("/article/insertArticleInfo",a).then((e=>{0==e.data.code&&Y().get("/updateArticleNumberByClassifyId",{params:{classifyId:r.write.classifyValue}}).then((e=>{l.value="<p></p>",r.write={titleValue:"",abstractValue:"",thumbnailValue:"",classifyValue:"",stateValue:"1",commentValue:"1"},(0,T.bM)({title:"提示",message:0==r.userInfo.userType?"文章发布成功！":"文章提交成功，等待管理员审核",type:"success"})}))}))}else B.z8.error("除缩略图之外的内容都是必填项哦~")};return{...(0,H.BK)(r),beforeUploadFunction:u,handleAvatarSuccess:s,submitAdd:c,editorRef:e,valueHtml:l,mode:"default",toolbarConfig:a,editorConfig:i,handleCreated:o,previewArticleCloseDialog:n}}};const K=(0,R.Z)($,[["render",N],["__scopeId","data-v-ff100586"]]);var X=K}}]);